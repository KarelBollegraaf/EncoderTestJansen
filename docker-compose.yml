version: "2.4"

services:
  jansen_encoder:
    image: "${IMAGE_NAME}"
    container_name: jansen_encoder
    restart: unless-stopped
    mem_limit: 128m
    mem_reservation: 64m
    ports:
      - "8000:8000"
    volumes:
      - encoder_data:/data
    environment:
      DB_PATH: /data/encoder.db

      # Encoder
      ENCODER_IP: ${ENCODER_IP:-192.168.1.250}
      ENCODER_PORT: ${ENCODER_PORT:-502}
      POLL_INTERVAL: ${POLL_INTERVAL:-0.1}
      ENCODER_TIMEOUT: ${ENCODER_TIMEOUT:-3}

      # PLC Modbus
      PLC_IP: ${PLC_IP:-192.168.1.15}
      PLC_PORT: ${PLC_PORT:-502}
      PLC_DEVICE_ID: ${PLC_DEVICE_ID:-1}
      PLC_POLL_SEC: ${PLC_POLL_SEC:-0.1}
      PLC_TIMEOUT_SEC: ${PLC_TIMEOUT_SEC:-3}

      # Health/watchdog
      HEARTBEAT_FILE: /tmp/collector_heartbeat.txt
      WATCHDOG_STALE_SEC: 20
      HEALTH_STALE_SEC: 20

volumes:
  encoder_data:
